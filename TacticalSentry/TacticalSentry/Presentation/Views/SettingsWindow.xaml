<Window x:Class="TacticalSentry.Presentation.Views.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="clr-namespace:TacticalSentry.Presentation.ViewModels"
        Title="GELİŞMİŞ SİSTEM AYARLARI" Height="650" Width="950"
        Background="#1E1E1E" WindowStartupLocation="CenterScreen" ResizeMode="NoResize">

    <Window.DataContext>
        <vm:SettingsViewModel/>
    </Window.DataContext>

    <Window.Resources>
        <Style TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="#333"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="Padding" Value="8"/>
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="FontWeight" Value="Bold"/>
        </Style>

        <BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </Window.Resources>

    <Grid Margin="15">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TextBlock Text="KOMUTA KONTROL MERKEZİ" Foreground="#00FF41" FontSize="24" FontWeight="Bold" HorizontalAlignment="Center" Margin="0,0,0,15">
            <TextBlock.Effect>
                <DropShadowEffect Color="#00FF41" BlurRadius="10" ShadowDepth="0"/>
            </TextBlock.Effect>
        </TextBlock>

        <TabControl Grid.Row="1" Background="#252525" BorderBrush="#00FF41">

            <TabItem Header="GENEL YAPILANDIRMA">
                <Grid Margin="20">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel Grid.Column="0">
                        <TextBlock Text="OTOMASYON PROTOKOLLERİ" Foreground="Gray" Margin="0,0,0,10" FontWeight="Bold"/>
                        <CheckBox IsChecked="{Binding IsSoundOn}" Content="Sesli Uyarı Sistemi (Alarm)" Foreground="White" Margin="0,5"/>
                        <CheckBox IsChecked="{Binding IsAutoRecord}" Content="Otomatik Kanıt Kaydı (SSD)" Foreground="White" Margin="0,5"/>

                        <TextBlock Text="ALGILAMA HASSASİYETİ" Foreground="Gray" Margin="0,25,0,5" FontWeight="Bold"/>
                        <Slider Minimum="0" Maximum="100" Value="{Binding Sensitivity}" IsSnapToTickEnabled="True" TickFrequency="5"/>
                        <ProgressBar Value="{Binding Sensitivity}" Height="5" Foreground="#00FF41" Background="#333" Margin="0,5"/>
                        <TextBlock Text="{Binding Sensitivity, StringFormat='Eşik Değeri: %{0}'}" Foreground="White" HorizontalAlignment="Right" FontSize="11"/>
                    </StackPanel>

                    <StackPanel Grid.Column="1" Margin="20,0,0,0">
                        <TextBlock Text="OPERASYON MODU" Foreground="Gray" Margin="0,0,0,10" FontWeight="Bold"/>
                        <RadioButton IsChecked="{Binding IsModeSafe}" Content="Güvenli Mod (Sadece Kayıt)" Foreground="White" Margin="0,5"/>
                        <RadioButton IsChecked="{Binding IsModeNormal}" Content="Standart Mod (Uyarı + Kayıt)" Foreground="White" Margin="0,5"/>
                        <RadioButton IsChecked="{Binding IsModeHostile}" Content="Savaş Modu (Agresif Uyarı)" Foreground="Red" FontWeight="Bold" Margin="0,5"/>

                        <TextBlock Text="YAPAY ZEKA ÇEKİRDEĞİ" Foreground="Gray" Margin="0,25,0,5" FontWeight="Bold"/>
                        <TextBox Text="{Binding SelectedModelPath}" IsReadOnly="True" Background="#333" Foreground="Yellow" BorderThickness="0" Padding="5"/>
                        <Button Command="{Binding SelectModelCommand}" Content="MODEL DOSYASI YÜKLE (.onnx)" Margin="0,5" Background="#444" Foreground="White" Padding="5" Cursor="Hand"/>
                    </StackPanel>
                </Grid>
            </TabItem>

            <TabItem Header="TEHDİT LOGLARI">
                <Grid Margin="10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="*"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>

                    <DataGrid Grid.Row="0" ItemsSource="{Binding LogHistory}" AutoGenerateColumns="False" 
                              Background="#222" RowBackground="#333" AlternatingRowBackground="#444" 
                              Foreground="White" HeadersVisibility="Column" GridLinesVisibility="Horizontal"
                              HorizontalGridLinesBrush="#555" BorderBrush="#00FF41" BorderThickness="1">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="ID" Binding="{Binding Id}" Width="50"/>
                            <DataGridTextColumn Header="TEHDİT TÜRÜ" Binding="{Binding ThreatType}" Width="*"/>
                            <DataGridTextColumn Header="ZAMAN DAMGASI" Binding="{Binding DetectedTime}" Width="*"/>
                            <DataGridTextColumn Header="DURUM" Binding="{Binding Status}" Width="*"/>
                            <DataGridTextColumn Header="GÜVEN SKORU" Binding="{Binding Confidence}" Width="120"/>
                        </DataGrid.Columns>
                    </DataGrid>

                    <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Right" Margin="0,15,0,0">
                        <Button Command="{Binding ExportLogsCommand}" Content="ŞİFRELİ RAPOR AL" Padding="20,8" Margin="0,0,10,0" Background="#333" Foreground="White"/>
                        <Button Command="{Binding ClearLogsCommand}" Content="VERİTABANINI TEMİZLE" Padding="20,8" Background="#880000" Foreground="White" FontWeight="Bold"/>
                    </StackPanel>
                </Grid>
            </TabItem>

            <TabItem Header="PERSONEL YÖNETİMİ" Visibility="{Binding IsAdminPanelVisible, Converter={StaticResource BooleanToVisibilityConverter}}">
                <Grid Margin="15">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="300"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <Border Grid.Column="0" BorderBrush="#444" BorderThickness="0,0,1,0" Margin="0,0,15,0" Padding="0,0,15,0">
                        <StackPanel VerticalAlignment="Center">
                            <TextBlock Text="YENİ OPERATÖR EKLE" Foreground="#00FF41" FontWeight="Bold" FontSize="16" HorizontalAlignment="Center" Margin="0,0,0,20"/>

                            <TextBlock Text="Kullanıcı Adı:" Foreground="Gray" Margin="0,0,0,5"/>
                            <TextBox Text="{Binding NewUsername}" Background="#333" Foreground="White" Padding="8" BorderThickness="0" Margin="0,0,0,15"/>

                            <TextBlock Text="Erişim Şifresi:" Foreground="Gray" Margin="0,0,0,5"/>
                            <TextBox Text="{Binding NewPassword}" Background="#333" Foreground="White" Padding="8" BorderThickness="0" Margin="0,0,0,25"/>

                            <Button Command="{Binding AddUserCommand}" Content="PERSONELİ SİSTEME EKLE" 
                                    Background="#004400" Foreground="White" FontWeight="Bold" Height="40" Cursor="Hand"/>

                            <TextBlock Text="NOT: Yeni personel 'Standart Yetki (Seviye 1)' ile başlar." 
                                       Foreground="Gray" FontSize="11" Margin="0,20,0,0" TextWrapping="Wrap" TextAlignment="Center" FontStyle="Italic"/>
                        </StackPanel>
                    </Border>

                    <Grid Grid.Column="1">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <TextBlock Grid.Row="0" Text="AKTİF PERSONEL LİSTESİ" Foreground="White" FontWeight="Bold" Margin="0,0,0,10"/>

                        <DataGrid Grid.Row="1" ItemsSource="{Binding PersonnelList}" 
                                  SelectedItem="{Binding SelectedPersonnel}"
                                  AutoGenerateColumns="False"
                                  Background="#222" RowBackground="#333" AlternatingRowBackground="#444" 
                                  Foreground="White" HeadersVisibility="Column" GridLinesVisibility="Horizontal"
                                  HorizontalGridLinesBrush="#555" BorderBrush="#00FF41" BorderThickness="1" 
                                  IsReadOnly="True" SelectionMode="Single">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="KULLANICI ADI" Binding="{Binding Username}" Width="*"/>
                                <DataGridTextColumn Header="HİZMET NO" Binding="{Binding ServiceNumber}" Width="150"/>
                                <DataGridTextColumn Header="YETKİ" Binding="{Binding ClearanceLevel}" Width="100"/>
                            </DataGrid.Columns>
                        </DataGrid>

                        <Button Grid.Row="2" Command="{Binding DeleteUserCommand}" 
                                Content="SEÇİLİ PERSONELİ SİL" 
                                Background="#660000" Foreground="White" FontWeight="Bold" 
                                Margin="0,15,0,0" Height="35" Cursor="Hand">
                            <Button.Effect>
                                <DropShadowEffect Color="Red" BlurRadius="15" Opacity="0.3" ShadowDepth="0"/>
                            </Button.Effect>
                        </Button>
                    </Grid>
                </Grid>
            </TabItem>

            <TabItem Header="SİSTEM DURUMU">
                <StackPanel Margin="30">
                    <GroupBox Header="Yazılım Bilgisi" Foreground="White" BorderBrush="#00FF41" Padding="20">
                        <StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,8">
                                <TextBlock Text="Proje Adı: " Foreground="Gray" Width="120"/>
                                <TextBlock Text="Tactical Sentry C2" Foreground="White" FontWeight="Bold"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,8">
                                <TextBlock Text="Versiyon: " Foreground="Gray" Width="120"/>
                                <TextBlock Text="3.2.1 (Production Release)" Foreground="White"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,8">
                                <TextBlock Text="Veritabanı: " Foreground="Gray" Width="120"/>
                                <TextBlock Text="SQLite (Yerel Şifreli Depolama)" Foreground="#00FF41"/>
                            </StackPanel>
                            <StackPanel Orientation="Horizontal" Margin="0,8">
                                <TextBlock Text="AI Modeli: " Foreground="Gray" Width="120"/>
                                <TextBlock Text="YOLOv8 - ONNX Runtime" Foreground="Yellow"/>
                            </StackPanel>
                        </StackPanel>
                    </GroupBox>

                    <TextBlock Text="TÜM SİSTEMLER ÇEVRİMİÇİ" Foreground="#00FF41" HorizontalAlignment="Center" Margin="0,40,0,0" FontSize="16" FontWeight="Bold"/>
                </StackPanel>
            </TabItem>

        </TabControl>

        <Button Grid.Row="2" Command="{Binding SaveSettingsCommand}" Content="YAPILANDIRMAYI KAYDET VE KAPAT" 
                Background="#004400" Foreground="White" FontWeight="Bold" Height="50" Margin="0,15,0,0" FontSize="14" Cursor="Hand">
            <Button.Effect>
                <DropShadowEffect Color="#00FF41" BlurRadius="10" ShadowDepth="0" Opacity="0.3"/>
            </Button.Effect>
        </Button>
    </Grid>
</Window>